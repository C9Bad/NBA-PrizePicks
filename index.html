<!DOCTYPE html>
<html>

<head>
    <title>NBA Bet Tracker</title>
    <style>
        :root {
            --bg: #1a1a1a;
            --text: #ffffff;
            --primary: #bb86fc;
            --secondary: #3700b3;
            --surface: #2d2d2d;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }

        .floating-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--surface);
            padding: 20px;
            border-radius: 8px;
            width: 300px;
        }

        .modal input,
        .modal select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border: 1px solid #444;
            background: #333;
            color: white;
        }

        .modal button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
        }

        .game-card {
            background: var(--surface);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .game-card:hover {
            transform: translateY(-2px);
        }

        .scoreboard {
            display: flex;
            justify-content: space-between;
            background: var(--surface);
            padding: 20px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .team {
            text-align: center;
        }

        .game-info {
            text-align: center;
        }

        #game-details {
            margin-top: 20px;
        }

        .team-players {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .player-list {
            background: var(--surface);
            padding: 15px;
            border-radius: 10px;
        }
    </style>
</head>

<body>
    <h1>Live Games</h1>
    <div id="games"></div>

    <div id="game-details" style="display: none;">
        <h2>Game Details</h2>
        <div id="detail-content"></div>
        <div class="team-players">
            <div class="player-list" id="awayPlayers"></div>
            <div class="player-list" id="homePlayers"></div>
        </div>
    </div>

    <button class="floating-btn" onclick="showModal()">+</button>

    <div id="modal" class="modal">
        <h3>New Bet</h3>
        <form onsubmit="submitBet(event)">
            <select id="player-select" required>
                <option value="">Select Player</option>
            </select>
            <select id="bet-type" required>
                <option value="points">Points</option>
                <option value="assists">Assists</option>
                <option value="rebounds">Rebounds</option>
                <option value="points+assists">Points + Assists</option>
                <option value="points+rebounds">Points + Rebounds</option>
                <option value="assists+rebounds">Assists + Rebounds</option>
                <option value="points+assists+rebounds">Points + Assists + Rebounds</option>
            </select>
            <input type="number" step="0.5" placeholder="Target" required>
            <button type="submit">Track Bet</button>
        </form>
    </div>

    <script>
        let currentGameId = null;

        async function loadGames() {
            const response = await fetch('/games');
            const games = await response.json();
            renderGames(games);
        }

        function renderGames(games) {
            const container = document.getElementById('games');
            container.innerHTML = games.map(game => `
                <div class="game-card" onclick="showGameDetails('${game.gameId}')">
                    <h3>${game.awayTeam} vs ${game.homeTeam}</h3>
                    <p>Status: ${getStatusText(game.status)}</p>
                    ${game.gameTimeET ? `<p>Time: ${game.gameTimeET}</p>` : ''}
                </div>
            `).join('');
        }

        async function showGameDetails(gameId) {
            currentGameId = gameId;

            // Load game details
            const details = await (await fetch(`/games/${gameId}`)).json();
            document.getElementById('detail-content').innerHTML = `
                <div class="scoreboard">
                    <div class="team">
                        <h3>${details.awayLeaders.teamTricode}</h3>
                        <p>Score: ${details.awayScore}</p>
                        <p>Leader: ${details.awayLeaders.name} (${details.awayLeaders.points}PTS)</p>
                    </div>
                    <div class="game-info">
                        <p>${details.statusText}</p>
                        ${details.gameClock ? `<p>Clock: ${details.gameClock.replace('PT','').replace('M',':').replace('S','')}</p>` : ''}
                        <p>Quarter: ${details.period}</p>
                    </div>
                    <div class="team">
                        <h3>${details.homeLeaders.teamTricode}</h3>
                        <p>Score: ${details.homeScore}</p>
                        <p>Leader: ${details.homeLeaders.name} (${details.homeLeaders.points}PTS)</p>
                    </div>
                </div>
            `;

            // Load players
            const players = await (await fetch(`/games/${gameId}/players`)).json();
            document.getElementById('awayPlayers').innerHTML = `
                <h4>${details.awayLeaders.teamTricode} Players</h4>
                <ul>${players.awayTeamPlayers.map(p => `<li>${p}</li>`).join('')}</ul>
            `;
            document.getElementById('homePlayers').innerHTML = `
                <h4>${details.homeLeaders.teamTricode} Players</h4>
                <ul>${players.homeTeamPlayers.map(p => `<li>${p}</li>`).join('')}</ul>
            `;

            // Populate player dropdown
            const select = document.getElementById('player-select');
            select.innerHTML = '<option value="">Select Player</option>' + [...players.homeTeamPlayers, ...players
                    .awayTeamPlayers
                ]
                .map(player => `<option value="${player}">${player}</option>`)
                .join('');

            document.getElementById('game-details').style.display = 'block';
        }

        function showModal() {
            document.getElementById('modal').style.display = 'block';
        }

        function submitBet(event) {
            event.preventDefault();
            const formData = {
                player: document.getElementById('player-select').value,
                bet_type: document.getElementById('bet-type').value,
                target: parseFloat(event.target.querySelector('input').value),
                game_id: currentGameId
            };
            console.log('Submitting bet:', formData);
            alert('Bet submitted!');
            document.getElementById('modal').style.display = 'none';
        }

        function getStatusText(status) {
            switch (status) {
                case 1:
                    return 'Scheduled';
                case 2:
                    return 'Live';
                case 3:
                    return 'Final';
                default:
                    return 'Unknown';
            }
        }

        // Initial load
        loadGames();
    </script>
</body>

</html>